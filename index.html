<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Git Bash Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css">
    <style>
        body {
            background: #1e1e1e;
            margin: 0;
        }
        #terminal {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="terminal"></div>

    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script>
        const term = new Terminal({
            cursorBlink: true,
            fontFamily: "monospace",
            fontSize: 14,
            theme: {
                background: "#1e1e1e",
                foreground: "#ffffff"
            }
        });

        term.open(document.getElementById("terminal"));
        showPrompt();

        let command = "";

        term.onKey(e => {
            const char = e.key;
            const code = e.domEvent.keyCode;

            if (code === 13) { // Enter
                term.write("\r\n"); // yangi qator
                if (command.trim()) {
                    fetch("/run", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ cmd: command })
                    })
                    .then(res => res.text())
                    .then(output => {
                        term.write(output.replace(/\r?\n/g, "\r\n"));
                        term.write("\r\n");
                        showPrompt();
                    });
                } else {
                    showPrompt();
                }
                command = "";
            } else if (code === 8) { // Backspace
                if (command.length > 0) {
                    term.write("\b \b");
                    command = command.slice(0, -1);
                }
            } else {
                term.write(char);
                command += char;
            }
        });

        function showPrompt() {
            term.write("$ ");
        }
    </script>
</body>
</html>
